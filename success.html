<!DOCTYPE html>
<html><head>
  <!--Meta Data-->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Gamify your self-improvement">
  <meta name="google-site-verification" content="Of745Ts_laOfoDCPg1Wc3TDyvl06z_Sg7EgDJ_l4hR8" />

  <title>SkillTree</title>

  <!-- Links -->
  <link rel="icon" href="Images/Logos/logo-small.png" type="image/png">
  <link rel="stylesheet" href="css/main.css" type="text/css">
  <link rel="stylesheet" href="css/success.css" type="text/css">
  <link rel="icon" href="Images/Logos/logo-small.png" type="image/png">
</head>
<body id="body">

  <!-- there was no need for the complicated calculations for css :sob: -->
  <div class="bg" style="height: 100%">
    <div class="bg-img"></div>
    <div class="bg-dim"></div>
    <div class="bg-shadow-flipped" style="top: 100%; height: 100%"></div>
    <div class="bg-shadow" style="top: -1050px; height: calc(100% + 1050px)"></div>
    <div class="bg-gradient"></div>
  </div>

<div class="d-flex justify-content-center align-items-center h-100">
  <div class="card text-center">
    <div class="card-body">
      <h5 class="card-title">SUCCESS</h5>
      <p class="card-text" id="text-body">You have successfully authenticated.</p>
      <p class="card-subtitle" id="text-subtitle">If you aren't automatically redirected to the app, click the return button.</p>
      <a class="btn btn-primary" id="button-redirect" onClick="redirectApp()">RETURN</a>
    </div>
  </div>
</div>

<script>
  const purposes = {
    "authenticated": {
      "body": "You have successfully authenticated.",
      "subtitle": "If you aren't automatically redirected to the app, click the return button.",
      "button": true,
    },
    "email-verified": {
      "body": "You have successfully verified your email address.",
      "subtitle": "You can now return to the app."
    },
    "password-changed": {
      "body": "You have successfully changed your email address.",
      "subtitle": "You have been logged out of all your devices, please log back in."
    }
  }

  // Get query string for redirect from /success?redirect=appURI
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const appURI = urlParams.get('redirect');
  const purpose = urlParams.get('purpose');

  const content = purposes[purpose]

  document.getElementById("text-body").textContent = content.body;
  document.getElementById("text-subtitle").textContent = content.subtitle;
  document.getElementById("button-redirect").hidden = !appURI;


  // Redirect to app after 5 seconds
  setTimeout(function() {
    redirectApp();
  }, 5000);

  // Redirect to app on button click
  function redirectApp() {
    if(!appURI) return;
    window.location.href = appURI;
  }
</script>

<!--JavaScript Imports-->
<script type="text/javascript" src="javascript/script.js"></script>

<div class="preloadedImages" style="background-image: url('Images/Icons/button.png')"></div>
<div class="preloadedImages" style="background-image: url('Images/Icons/button-clicked.png')"></div>
<div class="preloadedImages" style="background-image: url('Images/Icons/button-hover.png')"></div>

</body></html>
